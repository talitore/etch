<html>
<body>
<p>Whiteboard! Draw on me.</p>
</body>
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io();
</script>
<script>
  var canvas = document.createElement('canvas');
  canvas.width=600;
  canvas.height=480;
  document.body.appendChild(canvas);

  var ctx = canvas.getContext('2d');
  ctx.fillStyle = 'rgb(255,255,0)';
  ctx.fillRect(0,0,600,480);
  ctx.fillStyle = 'rgb(0,0,0)';
  function draw(x,y) {
    ctx.fillRect(x,y,4,4);
  }

  var mouseDown = 0;
  document.body.onmousedown = function() {
    ++mouseDown;
  }
  document.body.onmouseup = function() {
    --mouseDown;
  }
  socket.on("draw", function(params) {
    draw(params[0],params[1]);
  });

  canvas.addEventListener('mousedown', function(e) {
    params = [e.x-e.target.offsetLeft, e.y-e.target.offsetTop]
    socket.emit("draw", params)
  });
  canvas.addEventListener('mousemove', function(e) {
    if(mouseDown){
      params = [e.x-e.target.offsetLeft, e.y-e.target.offsetTop]
      socket.emit("draw", params)
    }
  });
</script>
</html>
